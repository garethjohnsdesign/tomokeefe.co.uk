# Running Release Notes for Craft 3.4

> {warning} If `useProjectConfigFile` is enabled and you are using the GraphQL API, restore a fresh database backup from your production environment before updating your development environment. Otherwise you may lose your GraphQL schema data when updating production.

> {tip} Element search indexing is a little smarter in Craft 3.4. It’s recommended that you resave all your entries from your terminal after updating.
>
> ```bash
> > ./craft resave/entries --update-search-index
> ```

### Added
- Improved the overall look and feel of the Control Panel. ([#2883](https://github.com/craftcms/cms/issues/2883))
- Added an overflow menu for Control Panel tabs that don’t fit into the available space. ([#3073](https://github.com/craftcms/cms/issues/3073))
- Added support for delta element updates. ([#4064](https://github.com/craftcms/cms/issues/4064))
- Elements now track which field values have changed since the element was first loaded. ([#4149](https://github.com/craftcms/cms/issues/4149))
- Entry drafts now show which fields and attributes have changed within the draft, and which are outdated.
- If an entry draft contains outdated field and attribute values, it’s now possible to merge the latest source entry values into the draft manually, and they will be automatically merged in when the draft is published. ([#4642](https://github.com/craftcms/cms/issues/4642))
- It’s now possible to see all of the elements selected by relation fields from element indexes. ([#3030](https://github.com/craftcms/cms/issues/3030))
- Assets now have their own dedicated edit pages in the control panel. ([#1249](https://github.com/craftcms/cms/issues/1249))
- Asset volumes’ field layouts can now define multiple tabs.
- Assets now keep track of which user account was logged-in when the asset was uploaded. ([#3553](https://github.com/craftcms/cms/issues/3553))
- Asset indexes can now have an “Uploaded by” column.
- It’s now possible to eager-load assets with their `uploader` value.
- Added new “View files uploaded by other users”, “Edit files uploaded by other users”, “Replace files uploaded by other users”, “Remove files uploaded by other users”, and “Edit images uploaded by other users” user permissions.
- Assets fields now have a “Show unpermitted volumes” setting, which determines whether the field should show volumes that the user doesn’t have permission to view (disabled by default for new fields; enabled by default for existing fields). ([#887](https://github.com/craftcms/cms/issues/887))
- Assets fields now have a “Show unpermitted files setting, which determines whether the field should show files that the user doesn’t have permission to view per the new “View files uploaded by other users” permission.
- It’s now possible to download multiple assets at once as a zip file. ([#5259](https://github.com/craftcms/cms/issues/5259))
- It’s now possible to preview HTML and PDF assets, and plugins can add support for additional file types. ([#5136](https://github.com/craftcms/cms/pull/5136))
- It’s now possible to set a custom aspect ratio when cropping images with the image editor. ([#4359](https://github.com/craftcms/cms/issues/4359))
- It’s now possible to change the the aspect ratio orientation when cropping images with the image editor. ([#4359](https://github.com/craftcms/cms/issues/4359))
- Added the `utils/prune-revisions` action. ([#4851](https://github.com/craftcms/cms/issues/4851))
- Added the `verifyEmailPath` config setting.
- Added the `maxBackups` config setting. ([#2078](https://github.com/craftcms/cms/issues/2078))
- Added the `upscaleImages` config setting. ([#844](https://github.com/craftcms/cms/issues/844))
- Added the `{% requireGuest %}` Twig tag, which redirects a user to the path specified by the `postLoginRedirect` config setting if they’re already logged in. ([#5015](https://github.com/craftcms/cms/pull/5015))
- Added the `|purify` Twig filter. ([#5184](https://github.com/craftcms/cms/issues/5184))
- It’s now possible to query for Matrix blocks by their field handle, via the new `field` param. ([#5218](https://github.com/craftcms/cms/issues/5218))
- It’s now possible to filter element query results by their related elements using relational fields’ element query params (e.g. `publisher(100)` rather than `relatedTo({targetElement: 100, field: 'publisher'})`). ([#5200](https://github.com/craftcms/cms/issues/5200))
- It’s now possible to query for elements by their custom field values via GraphQL. ([#5208](https://github.com/craftcms/cms/issues/5208))
- It’s now possible to eager-load the *count* of related elements, by setting `'count' => true` on the eager-loading criteria. 
- GraphQL access tokens are now managed separately from schema definitions, making it possible to create multiple tokens for the same schema.
- GraphQL schemas are now stored in the project config (sans tokens). ([#4829]((https://github.com/craftcms/cms/issues/4829))
- Added a new “Expanded” element exporter type, which includes expanded custom field values, including Matrix and relational fields. ([#4484](https://github.com/craftcms/cms/issues/4484))
- It’s now possible to export elements as CSV, JSON, or XML files.
- Added support for plugin-supplied element exporters. ([#5090](https://github.com/craftcms/cms/issues/5090))
- Control panel pages can now implement Vue-based admin tables that support bulk actions, search, and pagination.
- Added the `_count` field to all Elements when using GraphQL that returns the total related elements for a field. ([#4847](https://github.com/craftcms/cms/issues/4847))
- It’s now possible to filter users by user groups when querying for them using GraphQL. ([#5374](https://github.com/craftcms/cms/issues/5374)) 
- Added the `asset`, `category`, `entry`, `globalSet`, `tag`, and `user` queries to fetch a single element using the GraphQL API. ([#5363](https://github.com/craftcms/cms/issues/5363))
- Added `craft\assetpreviews\HtmlPreview`.
- Added `craft\assetpreviews\ImagePreview`.
- Added `craft\assetpreviews\NoPreview`.
- Added `craft\assetpreviews\PdfPreview`.
- Added `craft\base\AssetPreviewInterface`.
- Added `craft\base\AssetPreviewTrait`.
- Added `craft\base\AssetPreview`.
- Added `craft\base\Element::ATTR_STATUS_CONFLICTED`.
- Added `craft\base\Element::ATTR_STATUS_MODIFIED`.
- Added `craft\base\Element::ATTR_STATUS_OUTDATED`.
- Added `craft\base\Element::EVENT_REGISTER_EXPORTERS`.
- Added `craft\base\Element::defineExporters()`.
- Added `craft\base\ElementExporterInterface`.
- Added `craft\base\ElementExporter`.
- Added `craft\base\ElementInterface::exporters()`
- Added `craft\base\ElementInterface::getAttributeStatus()`.
- Added `craft\base\ElementInterface::getDirtyAttributes()`.
- Added `craft\base\ElementInterface::getDirtyFields()`.
- Added `craft\base\ElementInterface::getEagerLoadedElementCount()`.
- Added `craft\base\ElementInterface::getFieldStatus()`.
- Added `craft\base\ElementInterface::isFieldDirty()`.
- Added `craft\base\ElementInterface::markAsClean()`.
- Added `craft\base\ElementInterface::setAttributeStatus()`.
- Added `craft\base\ElementInterface::setEagerLoadedElementCount()`.
- Added `craft\base\ElementInterface::trackChanges()`.
- Added `craft\base\FieldInterface::getTranslationDescription()`.
- Added `craft\behaviors\DraftBehavior::$dateLastMerged`.
- Added `craft\behaviors\DraftBehavior::$mergingChanges`.
- Added `craft\behaviors\DraftBehavior::$trackChanges`.
- Added `craft\behaviors\DraftBehavior::getIsOutdated()`.
- Added `craft\behaviors\DraftBehavior::getOutdatedAttributes()`.
- Added `craft\behaviors\DraftBehavior::getOutdatedFields()`.
- Added `craft\behaviors\DraftBehavior::isAttributeModified()`.
- Added `craft\behaviors\DraftBehavior::isAttributeOutdated()`.
- Added `craft\behaviors\DraftBehavior::isFieldModified()`.
- Added `craft\behaviors\DraftBehavior::isFieldOutdated()`.
- Added `craft\controllers\AssetsController::actionEditAsset()`.
- Added `craft\controllers\AssetsController::actionSaveAsset()`.
- Added `craft\controllers\DraftsController`.
- Added `craft\controllers\GraphqlController::actionDeleteToken()`.
- Added `craft\controllers\GraphqlController::actionEditPublicSchema()`.
- Added `craft\controllers\GraphqlController::actionEditPublicSchema()`.
- Added `craft\controllers\GraphqlController::actionEditToken()`.
- Added `craft\controllers\GraphqlController::actionSaveToken()`.
- Added `craft\controllers\GraphqlController::actionViewToken()`.
- Added `craft\controllers\UsersController::actionSessionInfo()`. ([#5355](https://github.com/craftcms/cms/issues/5355))
- Added `craft\db\Connection::DRIVER_MYSQL`.
- Added `craft\db\Connection::DRIVER_PGSQL`.
- Added `craft\elements\Asset::$uploaderId`.
- Added `craft\elements\Asset::getDimensions()`.
- Added `craft\elements\Asset::getFormattedSize()`.
- Added `craft\elements\Asset::getFormattedSizeInBytes()`.
- Added `craft\elements\Asset::getPreviewThumbImg()`.
- Added `craft\elements\Asset::getUploader()`.
- Added `craft\elements\Asset::setUploader()`.
- Added `craft\elements\MatrixBlock::$dirty`.
- Added `craft\elements\db\AssetQuery::$uploaderId`.
- Added `craft\elements\db\AssetQuery::uploader()`.
- Added `craft\elements\db\ElementQuery::clearCachedResult()`.
- Added `craft\elements\db\MatrixBlockQuery::field()`.
- Added `craft\elements\exporters\Expanded`.
- Added `craft\elements\exporters\Raw`.
- Added `craft\events\AssetPreviewEvent`.
- Added `craft\events\BackupEvent::$ignoreTables`. ([#5330](https://github.com/craftcms/cms/issues/5330))
- Added `craft\events\DefineGqlTypeFieldsEvent`.
- Added `craft\events\DefineGqlValidationRulesEvent`.
- Added `craft\events\ExecuteGqlQueryEvent::$schemaId`.
- Added `craft\events\RegisterElementExportersEvent`.
- Added `craft\events\RegisterGqlPermissionsEvent`.
- Added `craft\events\TemplateEvent::$templateMode`.
- Added `craft\fields\Assets::$showUnpermittedVolumes`.
- Added `craft\gql\TypeManager`.
- Added `craft\gql\types\Number`.
- Added `craft\helpers\AdminTable`.
- Added `craft\helpers\ArrayHelper::append()`.
- Added `craft\helpers\ArrayHelper::prepend()`.
- Added `craft\helpers\Db::parseDsn()`.
- Added `craft\helpers\Db::url2config()`.
- Added `craft\helpers\FileHelper::writeGitignoreFile()`.
- Added `craft\helpers\ProjectConfigHelper::flattenConfigArray()`.
- Added `craft\helpers\ProjectConfigHelper::packAssociativeArray()`.
- Added `craft\helpers\ProjectConfigHelper::unpackAssociativeArray()`.
- Added `craft\models\FieldLayoutTab::elementHasErrors()`.
- Added `craft\models\GqlToken`.
- Added `craft\queue\jobs\UpdateSearchIndex::$fieldHandles`.
- Added `craft\records\Asset::getUploader()`.
- Added `craft\records\GqlToken`.
- Added `craft\services\Assets::EVENT_GET_ASSET_PREVIEW`.
- Added `craft\services\Assets::getAssetPreview()`.
- Added `craft\services\Drafts::EVENT_AFTER_MERGE_SOURCE_CHANGES`.
- Added `craft\services\Drafts::EVENT_BEFORE_MERGE_SOURCE_CHANGES`.
- Added `craft\services\Drafts::mergeSourceChanges()`.
- Added `craft\services\Elements::createExporter()`.
- Added `craft\services\Gql::CONFIG_GQL_SCHEMAS_KEY`.
- Added `craft\services\Gql::EVENT_REGISTER_GQL_PERMISSIONS`.
- Added `craft\services\Gql::GRAPHQL_COUNT_FIELD`.
- Added `craft\services\Gql::deleteSchema()`.
- Added `craft\services\Gql::deleteTokenById()`.
- Added `craft\services\Gql::getSchemaByUid()`.
- Added `craft\services\Gql::getTokenByAccessToken()`.
- Added `craft\services\Gql::getTokenById()`.
- Added `craft\services\Gql::getTokenByUid()`.
- Added `craft\services\Gql::getTokens()`.
- Added `craft\services\Gql::getValidationRules()`.
- Added `craft\services\Gql::handleChangedSchema()`.
- Added `craft\services\Gql::handleDeletedSchema()`.
- Added `craft\services\Gql::saveToken()`.
- Added `craft\services\Path::getConfigDeltaPath()`.
- Added `craft\services\Plugins::$pluginConfigs`. ([#1989](https://github.com/craftcms/cms/issues/1989))
- Added `craft\services\ProjectConfig::CONFIG_ALL_KEY`.
- Added `craft\services\ProjectConfig::CONFIG_ASSOC_KEY`.
- Added `craft\services\ProjectConfig::$maxDeltas`.
- Added `craft\services\ProjectConfig::CONFIG_DELTA_FILENAME`.
- Added `craft\services\ProjectConfig::CONFIG_DELTA_FILENAME`.
- Added `craft\services\ProjectConfig::CONFIG_DELTA_FILENAME`.
- Added `craft\services\ProjectConfig::CONFIG_DELTA_FILENAME`.
- Added `craft\services\ProjectConfig::CONFIG_DELTA_FILENAME`.
- Added `craft\services\ProjectConfig::CONFIG_DELTA_FILENAME`.
- Added `craft\services\ProjectConfig::CONFIG_DELTA_FILENAME`.
- Added `craft\services\ProjectConfig::CONFIG_DELTA_FILENAME`.
- Added `craft\web\assets\admintable\AdminTableAsset`.
- Added `craft\web\Controller::requireGuest()`.
- Added `craft\web\CsvResponseFormatter`.
- Added `craft\web\User::guestRequired()`.
- Added `craft\web\View::$minifyCss`.
- Added `craft\web\View::$minifyJs`.
- Added `craft\web\View::getDeltaNames()`.
- Added `craft\web\View::getIsDeltaRegistrationActive()`.
- Added `craft\web\View::registerDeltaName()`.
- Added `craft\web\View::setIsDeltaRegistrationActive()`.
- Added `craft\web\twig\nodes\RequireGuestNode`.
- Added `craft\web\twig\tokenparsers\RequireGuestTokenParser`.
- Added `craft\web\twig\variables\Paginate::getDynamicRangeUrls()`, making it easy to create Google-style pagination links. ([#5005](https://github.com/craftcms/cms/issues/5005))
- Added the `Craft.ui.createDateRangePicker()` JavaScript method.
- Added the `Craft.VueAdminTable` JavaScript class.
- Added the `cp.users.edit.prefs` template hook to the Edit User page. ([#5114](https://github.com/craftcms/cms/issues/5114))
- The `_layouts/elements.html` control panel layout template can now be used for elements that don’t support drafts or revisions.
- Added the [Interactive Shell Extension for Yii 2](https://github.com/yiisoft/yii2-shell).
- Added the Minify PHP package.

### Changed
- Control panel requests are now always set to the primary site, regardless of the URL they were accessed from.
- The control panel no longer shows the tab bar on pages with only one tab. ([#2915](https://github.com/craftcms/cms/issues/2915))
- The Assets index page now updates the URL when the selected volume changes.
- Sections’ entry URI format settings are now shown when running Craft in headless mode. ([#4934](https://github.com/craftcms/cms/issues/4934))
- The “Primary entry page” preview target is now user-customizable alongside all other preview targets in sections’ settings. ([#4520](https://github.com/craftcms/cms/issues/4520))
- Plain Text fields can now specify a maximum size in bytes. ([#5099](https://github.com/craftcms/cms/issues/5099))
- Plain Text fields’ Column Type settings now have an “Automatic” option, which is selected by default for new fields. ([#5099](https://github.com/craftcms/cms/issues/5099))
- Matrix fields now show an accurate description of their propagation behavior in the translation icon tooltip. ([#5304](https://github.com/craftcms/cms/issues/5304))
- The `users/login` action no longer sets a “Logged in.” flash notice. ([#5383](https://github.com/craftcms/cms/issues/5383))
- Local asset volumes now ensure that their folder exists on save, and if it doesn’t, a `.gitignore` file will be added automatically to it, excluding the directory from Git. ([#5237](https://github.com/craftcms/cms/issues/5237))
- Set Password and Verify Email links now use the `setPasswordPath` and `verifyEmailPath` config settings. ([#4925](https://github.com/craftcms/cms/issues/4925))
- Craft now uses the `slugWordSeparator` when generating URI formats. ([#5315](https://github.com/craftcms/cms/pull/5315))
- The `loginPath` and `logoutPath` config setings can now be set to `false` to disable front-end login/logout. ([#5352](https://github.com/craftcms/cms/issues/5352))
- The `loginPath`, `logoutPath`, `setPasswordPath`, and `verifyEmailPath` config settings are now ignored when Craft is running in headless mode.
- CSS registered with `craft\web\View::registerCss()` or the `{% css %}` tag is now minified by default. ([#5183](https://github.com/craftcms/cms/issues/5183))
- JavaScript code registered with `craft\web\registerJs()` or the `{% js %}` tag is now minified per the `useCompressedJs` config setting. ([#5183](https://github.com/craftcms/cms/issues/5183))
- `resave/*` commands now have an `--update-search-index` argument (defaults to `false`). ([#4840](https://github.com/craftcms/cms/issues/4840))
- The installer now requires `config/db.php` to be setting the `dsn` database config setting with a `DB_DSN` environment variable, if a connection can’t already be established.
- The full GraphQL schema is now always generated when Dev Mode is enabled.
- Punctuation is now removed from search keywords and search terms, rather than being replaced with a space. ([#5214](https://github.com/craftcms/cms/issues/5214))
- The `_includes/forms/field.html` template now supports `fieldAttributes`, `labelAttributes`, and `inputAttributes` variables.
- The `_includes/field.html` template now supports a `registerDeltas` variable.
- The `_layouts/cp.html` template now supports `mainAttributes` and `mainFormAttributes` variables.
- Plugins can now modify the GraphQL schema via `craft\gql\TypeManager::EVENT_DEFINE_GQL_TYPE_FIELDS`.
- Plugins can now modify the GraphQL permissions via `craft\services\Gql::EVENT_REGISTER_GQL_PERMISSIONS`.
- Number fields now return the `Number` type when queried via GraphQL, which can be an integer, a float, or null. ([#5344](https://github.com/craftcms/cms/issues/5344))
- Renamed the`QueryParameter` GraphQL type to `QueryArgument`.
- If any elements are selected while exporting, only the selected elements will be included in the export. ([#5130](https://github.com/craftcms/cms/issues/5130))
- Craft now sorts the `project.yaml` file alphabetically by keys. ([#5147](https://github.com/craftcms/cms/issues/5147))
- The project config is now stored in its own `projectconfig` table, rather than a `config` column within the `info` table.
- Active record classes now normalize attribute values right when they are set.
- Element index pages no longer link to elements’ edit pages if `getIsEditable()` returns `false`.
- Entry queries no longer factor in seconds when looking for currently live entries. ([#5389](https://github.com/craftcms/cms/issues/5389))
- The old `craft\controllers\AssetsController::actionSaveAsset()` method has been renamed to `actionUpload()`.
- `craft\config\GeneralConfig::getLoginPath()` and `getLogoutPath()` may now return non-string values.
- `craft\helpers\Db::prepDateForDb()` now has a `$stripSeconds` argument (defaults to `false`).
- `craft\i18n\Formatter::asShortSize()` now capitalizes the size unit.
- `craft\models\GqlSchema::$scope` is now read-only.
- `craft\services\Elements::resaveElements()` now has an `$updateSearchIndex` argument (defaults to `false`). ([#4840](https://github.com/craftcms/cms/issues/4840))
- `craft\services\Elements::saveElement()` now has an `$updateSearchIndex` argument (defaults to `true`). ([#4840](https://github.com/craftcms/cms/issues/4840))
- `craft\services\ProjectConfig::processConfigChanges()` now has a `$message` argument to specify the reason for config changes.
- `craft\services\ProjectConfig::remove()` now has a `$message` argument to specify the reason for config changes.
- `craft\services\ProjectConfig::set()` now has a `$message` argument to specify the reason for config changes.
- `craft\services\Search::indexElementAttributes()` now has a `$fieldHandles` argument, for specifying which custom fields’ keywords should be updated.
- `craft\web\Controller::renderTemplate()` now has a `$templateMode` argument.
- `craft\web\View::renderTemplate()`, `renderPageTemplate()`, `renderTemplateMacro()`, `doesTemplateExist()`, and `resolveTemplate()` now have `$templateMode` arguments. ([#4570](https://github.com/craftcms/cms/pull/4570))
- Matrix fields now trigger a `blockDeleted` JavaScript event when a block is deleted. ([#5329](https://github.com/craftcms/cms/issues/5329))
- Updated Garnish to 0.1.32.

### Deprecated
- Deprecated the `url`, `driver`, `database`, `server`, `port`, and `unixSocket` database config settings. `dsn` should be used instead.
- Deprecated `craft\config\DbConfig::DRIVER_MYSQL`.
- Deprecated `craft\config\DbConfig::DRIVER_PGSQL`.
- Deprecated `craft\config\DbConfig::updateDsn()`.
- Deprecated `craft\controllers\UsersController::actionGetRemainingSessionTime()`. `actionSessionInfo()` should be used instead.
- Deprecated `craft\elements\Asset::getSupportsPreview()`. Use `craft\services\Assets::getAssetPreview()` instead.
- Deprecated `craft\events\ExecuteGqlQueryEvent::$accessToken`. Use `craft\events\ExecuteGqlQueryEvent::$schemaId` instead.
- Deprecated `craft\services\ProjectConfig::$maxBackups`. `$maxDeltas` should be used instead.
- Deprecated `craft\services\Search::indexElementFields()`.

### Removed
- Removed `craft\models\GqlSchema::PUBLIC_TOKEN`.
- Removed `craft\models\GqlSchema::$accessToken`.
- Removed `craft\models\GqlSchema::$enabled`.
- Removed `craft\models\GqlSchema::$expiryDate`.
- Removed `craft\models\GqlSchema::$lastUsed`.
- Removed `craft\models\GqlSchema::$dateCreated`.
- Removed `craft\models\GqlSchema::$isTemporary`.
- Removed `craft\models\GqlSchema::getIsPublic()`.

### Fixed
- Fixed a SQL error that could occur if the `info` table has more than one row. ([#5222](https://github.com/craftcms/cms/issues/5222))
- Fixed a layout issue where the control panel footer would be hidden if the Debug Toolbar was shown. ([#4591](https://github.com/craftcms/cms/issues/4591))
- Fixed a bug where the image editor would not immediately apply new aspect ratio selections when cropping images.
- Fixed a bug where the `maxBackups` config setting wasn’t getting applied if a custom `backupCommand` was set.
- Fixed a bug where it was impossible to use aliases for matrix fields when using GraphQL. ([#5008](https://github.com/craftcms/cms/issues/5008))
- Fixed a bug where Lightswitch column values within Table fields weren’t returning boolean values when queried via GraphQL. ([#5344](https://github.com/craftcms/cms/issues/5344))
