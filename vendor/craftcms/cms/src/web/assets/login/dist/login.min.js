!function(t){var s=Garnish.Base.extend({$form:null,$loginNameInput:null,$passwordFields:null,$passwordInput:null,$forgotPasswordLink:null,$rememberMeCheckbox:null,$sslIcon:null,$submitBtn:null,$spinner:null,$error:null,passwordInputInterval:null,forgotPassword:!1,loading:!1,init:function(){this.$form=t("#login-form"),this.$loginNameInput=t("#loginName"),this.$passwordFields=t("#password-fields"),this.$passwordInput=t("#password"),this.$forgotPasswordLink=t("#forgot-password"),this.$sslIcon=t("#ssl-icon"),this.$submitBtn=t("#submit"),this.$spinner=t("#spinner"),this.$rememberMeCheckbox=t("#rememberMe"),new Craft.PasswordInput(this.$passwordInput,{onToggleInput:t.proxy(function(s){this.removeListener(this.$passwordInput,"input"),this.$passwordInput=s,this.addListener(this.$passwordInput,"input","validate")},this)}),this.addListener(this.$loginNameInput,"input","validate"),this.addListener(this.$passwordInput,"input","validate"),this.addListener(this.$forgotPasswordLink,"click","onForgetPassword"),this.addListener(this.$form,"submit","onSubmit"),this.addListener(this.$sslIcon,"mouseover",function(){this.$sslIcon.hasClass("disabled")||this.$submitBtn.addClass("hover")}),this.addListener(this.$sslIcon,"mouseout",function(){this.$sslIcon.hasClass("disabled")||this.$submitBtn.removeClass("hover")}),this.addListener(this.$sslIcon,"mousedown",function(){this.$sslIcon.hasClass("disabled")||(this.$submitBtn.addClass("active"),this.addListener(Garnish.$doc,"mouseup",function(){this.$submitBtn.removeClass("active"),this.removeListener(Garnish.$doc,"mouseup")}))}),this.passwordInputInterval=setInterval(t.proxy(this,"validate"),250),this.addListener(this.$sslIcon,"click",function(){this.$submitBtn.trigger("click")})},validate:function(){return this.$loginNameInput.val()&&(this.forgotPassword||6<=this.$passwordInput.val().length)?(this.$sslIcon.enable(),this.$submitBtn.enable(),!0):(this.$sslIcon.disable(),this.$submitBtn.disable(),!1)},onSubmit:function(s){s.preventDefault(),this.validate()&&(this.$submitBtn.addClass("active"),this.$spinner.removeClass("hidden"),this.loading=!0,this.$error&&this.$error.remove(),this.forgotPassword?this.submitForgotPassword():this.submitLogin())},submitForgotPassword:function(){var s={loginName:this.$loginNameInput.val()};Craft.postActionRequest("users/send-password-reset-email",s,t.proxy(function(s,t){"success"===t&&(s.success?new i:this.showError(s.error)),this.onSubmitResponse()},this))},submitLogin:function(){var s={loginName:this.$loginNameInput.val(),password:this.$passwordInput.val(),rememberMe:this.$rememberMeCheckbox.prop("checked")?"y":""};return Craft.postActionRequest("users/login",s,t.proxy(function(s,t){"success"===t?s.success?window.location.href=s.returnUrl:(Garnish.shake(this.$form),this.onSubmitResponse(),this.showError(s.error)):this.onSubmitResponse()},this)),!1},onSubmitResponse:function(){this.$submitBtn.removeClass("active"),this.$spinner.addClass("hidden"),this.loading=!1},showError:function(s){s||(s=Craft.t("app","An unknown error occurred.")),this.$error=t('<p class="error" style="display:none">'+s+"</p>").insertAfter(t(".buttons",this.$form)),this.$error.velocity("fadeIn")},onForgetPassword:function(s){s.preventDefault(),Garnish.isMobileBrowser()||this.$loginNameInput.trigger("focus"),this.$error&&this.$error.remove(),this.$form.addClass("reset-password"),this.$passwordInput.remove(),this.$passwordFields.remove(),this.$submitBtn.addClass("reset-password"),this.$submitBtn.attr("value",Craft.t("app","Reset Password")),this.$submitBtn.enable(),this.$sslIcon.remove(),this.forgotPassword=!0,this.validate()}}),i=Garnish.Modal.extend({init:function(){var s=t('<div class="modal fitted email-sent"><div class="body">'+Craft.t("app","Check your email for instructions to reset your password.")+"</div></div>").appendTo(Garnish.$bod);this.base(s)},hide:function(){}});new s}(jQuery);
//# sourceMappingURL=login.min.js.map